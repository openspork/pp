{% extends "base.j2" %}
{% block title %}
RSoP
{% endblock %}

{% block content %}
	<h3>Resultant Set of Policy for: {{ mac_address }} </h3>
	<textarea class='xmlDisplay'>{{ xml }}</textarea>
	<h4>Cert Authority:</h4>
	{{ cert_authority_rsop.current_cert_authority.cert_authority.name }}

	{% for found_cert_authority in cert_authority_rsop.cert_authority_overrides %}

		{{ found_cert_authority.cert_authority.name }}

	{% endfor %}

	<h4>Inheritance / override details:</h4>
	CAs:
	<br>
		<ul>
			{% for found_cert_authority in cert_authority_rsop.cert_authority_overrides %}

			{{ found_cert_authority.cert_authority.name }} from <a href='{{ url_for('edit_group', id=found_cert_authority.group.id ) | safe }}'>group</a> at depth {{ found_cert_authority.depth }}

			{% endfor %}
		</ul>
	<br>
	Params
	<ul>
		{# key = param, value = (value, depth, overrides) #}
		{% for key, value in rsop|dictsort %}
			{# if at depth 0, this is a phone #}
			{% if value[2] == 0 %} 
				<li>{{ BaseParam.get(BaseParam.id == key).name }} = {{ value[0] }} from <a href='{{ url_for('edit_phone', id=value[1] ) | safe }}'>{{ Phone.get(Phone.id == value[1] ).name }}</a> at depth {{ value[2] }}
				{% if value[3] | length > 0 %} </li>
					Overrode:
					<ul>
						{% for overridden_value, overridden_group, overridden_depth in value[3] %}
							<li>{{ BaseParam.get(BaseParam.id == key).name }} = {{ overridden_value }} from <a href='{{ url_for('edit_group', id=overridden_group ) | safe }}'>{{ Group.get(Group.id == overridden_group ).name }}</a> at depth {{ overridden_depth }}</li>
						{% endfor %}
					</ul>
				{% endif %}
			{% else %} {# if > depth 0, this is a group #}
				<li>{{ BaseParam.get(BaseParam.id == key).name }} = {{ value[0] }} from <a href='{{ url_for('edit_group', id=value[1] ) | safe }}'>{{ Group.get(Group.id == value[1] ).name }}</a> at depth {{ value[2] }}
				{% if value[3] | length > 0 %}</li>
					Overrode:
					<ul>
						{% for overridden_value, overridden_group, overridden_depth in value[3] %}
							<li> {{ BaseParam.get(BaseParam.id == key).name }} = {{ overridden_value }} from <a href='{{ url_for('edit_group', id=overridden_group ) | safe }}'>{{ Group.get(Group.id == overridden_group ).name }}</a> at depth {{ overridden_depth }} </li>
						{% endfor %}
					</ul>
				{% endif %}
			{% endif %}
		{% endfor %}
	</ul>
	<br />
{% endblock %}